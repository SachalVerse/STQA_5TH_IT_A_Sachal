{
  "info": {
    "_postman_id": "84dcfb83-0cdd-4705-b50f-ff5398a61f8c",
    "name": "CropDoctorCollection",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "42787655"
  },
  "item": [
    {
      "name": "https://ai-crop-disease-detection.onrender.com/health",
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base url}}/health",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "health"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/sensors/store",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has id field', function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('id');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"temperature\":25.5,\"humidity\":60,\"soil\":1200,\"rain\":4095,\"light\":500}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base url}}/sensors/store",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "sensors",
            "store"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/sensors/latest\n",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Helper function to safely parse JSON response",
              "function tryParseJSON(responseText) {",
              "    try {",
              "        return JSON.parse(responseText);",
              "    } catch (e) {",
              "        return null;",
              "    }",
              "}",
              "",
              "const responseCode = pm.response.code;",
              "const jsonData = tryParseJSON(pm.response.text());",
              "",
              "pm.test('Status code is 200 or known error code', function () {",
              "    pm.expect(responseCode).to.be.oneOf([200, 400, 404, 500]);",
              "    ",
              "    if (responseCode === 404) {",
              "        console.warn('‚ö†Ô∏è Endpoint not found (404). Please verify:');",
              "        console.warn('   1. The \"base_url\" variable is correctly set (current value used in request)');",
              "        console.warn('   2. The endpoint path \"/sensors/latest\" exists on the server');",
              "        console.warn('   3. No trailing slash issues in URL concatenation');",
              "    }",
              "});",
              "",
              "// Only run JSON validation tests when status is 200",
              "if (responseCode === 200) {",
              "    pm.test('Response is valid JSON', function () {",
              "        pm.expect(jsonData).to.not.be.null;",
              "        pm.expect(jsonData).to.be.an('object');",
              "    });",
              "",
              "    pm.test('Response has required fields: id, timestamp, data', function () {",
              "        pm.expect(jsonData).to.have.property('id');",
              "        pm.expect(jsonData).to.have.property('timestamp');",
              "        pm.expect(jsonData).to.have.property('data');",
              "    });",
              "",
              "    pm.test('Field \"id\" is a number', function () {",
              "        pm.expect(jsonData.id).to.be.a('number');",
              "    });",
              "",
              "    pm.test('Response schema validation', function () {",
              "        pm.expect(jsonData).to.be.an('object');",
              "        pm.expect(jsonData.id).to.be.a('number');",
              "        // timestamp and data fields exist (type can vary based on API design)",
              "        pm.expect(jsonData).to.have.property('timestamp');",
              "        pm.expect(jsonData).to.have.property('data');",
              "    });",
              "}",
              "",
              "// Handle non-200 responses with detailed diagnostics",
              "if (responseCode !== 200) {",
              "    const responseBody = pm.response.text();",
              "    ",
              "    if (responseCode === 404) {",
              "        pm.test('404 response - endpoint not found (check base_url variable)', function () {",
              "            pm.expect(responseCode).to.equal(404);",
              "            console.log('‚ÑπÔ∏è Received 404 - endpoint may not exist or base_url may be misconfigured');",
              "            console.log('üí° Tip: Verify the \"base_url\" global/environment variable points to the correct server');",
              "            console.log('üìÑ Response body: ' + responseBody);",
              "        });",
              "    } else if (responseCode === 400) {",
              "        pm.test('400 response - bad request', function () {",
              "            pm.expect(responseCode).to.equal(400);",
              "            console.error('‚ùå Bad Request (400)');",
              "            console.log('üìÑ Response body: ' + responseBody);",
              "        });",
              "    } else if (responseCode === 500) {",
              "        pm.test('500 response - server error', function () {",
              "            pm.expect(responseCode).to.equal(500);",
              "            console.error('‚ùå Internal Server Error (500)');",
              "            console.log('üìÑ Response body: ' + responseBody);",
              "        });",
              "    } else {",
              "        pm.test('Unexpected response code: ' + responseCode, function () {",
              "            console.warn('‚ö†Ô∏è Unexpected status code: ' + responseCode);",
              "            console.log('üìÑ Response body: ' + responseBody);",
              "        });",
              "    }",
              "}"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Pre-request script to ensure base_url is set",
              "let baseUrl = pm.environment.get(\"base_url\") || pm.globals.get(\"base_url\");",
              "",
              "if (!baseUrl || baseUrl.trim() === \"\") {",
              "    const fallbackUrl = \"https://api.example.com\";",
              "    pm.globals.set(\"base_url\", fallbackUrl);",
              "    console.warn(\"‚ö†Ô∏è WARNING: 'base_url' was not set in environment or globals.\");",
              "    console.warn(\"   Setting base_url to fallback value: \" + fallbackUrl);",
              "    console.warn(\"   Please configure the correct base_url in your environment 'Crop Doctor API' or global variables.\");",
              "} else {",
              "    console.log(\"‚úÖ base_url is set to: \" + baseUrl);",
              "}"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base url}}/sensors/latest",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "sensors",
            "latest"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/sensors/history",
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base url}}/sensors/history?limit=5\n",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "sensors",
            "history"
          ],
          "query": [
            {
              "key": "limit",
              "value": "5\n"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/camera/upload\n",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Validate and set base_url if empty",
              "let baseUrl = pm.variables.get(\"base_url\");",
              "",
              "console.log(\"Current base_url value:\", baseUrl);",
              "",
              "if (!baseUrl || baseUrl.trim() === \"\") {",
              "    console.log(\"base_url is empty or not set. Setting default value...\");",
              "    pm.collectionVariables.set(\"base_url\", \"https://ai-crop-disease-detection.onrender.com\");",
              "    console.log(\"base_url set to: https://ai-crop-disease-detection.onrender.com\");",
              "} else {",
              "    console.log(\"base_url is valid:\", baseUrl);",
              "}"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 2xx\", function () {",
              "    pm.expect(pm.response.code).to.be.within(200, 299);",
              "});",
              "",
              "pm.test(\"Not 404\", function () {",
              "    pm.expect(pm.response.code).to.not.eql(404);",
              "});",
              "",
              "// Safely handle response and set latest_image_url if available",
              "try {",
              "    var json = pm.response.json();",
              "    if (json && json.image_url) {",
              "        pm.environment.set(\"latest_image_url\", json.image_url);",
              "        console.log(\"Set latest_image_url to:\", json.image_url);",
              "    }",
              "} catch (e) {",
              "    // Response is not JSON; ignore",
              "    console.log(\"Response is not JSON or could not be parsed\");",
              "}"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "file",
              "description": "Image file to upload for crop disease detection",
              "type": "file",
              "src": "postman-cloud:///1f0f312d-dd48-4a20-bfa5-d4c7d67ff32c"
            }
          ]
        },
        "url": {
          "raw": "{{base url}}/camera/upload",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "camera",
            "upload"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/camera/latest",
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base url}}/camera/latest",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "camera",
            "latest"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/predict",
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "file",
              "type": "file",
              "uuid": "f4d73c47-6a98-4dd7-bf0d-5f860f78667e",
              "src": "postman-cloud:///1f0f312d-dd48-4a20-bfa5-d4c7d67ff32c"
            },
            {
              "key": "include_guidance",
              "value": "true",
              "type": "text",
              "uuid": "1cbe3bf7-2009-4e63-abf8-9171bd6ec453"
            }
          ]
        },
        "url": {
          "raw": "{{base url}}/predict",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "predict"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base_url}}/predictions/history",
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base url}}/predictions/history?limit=5",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "predictions",
            "history"
          ],
          "query": [
            {
              "key": "limit",
              "value": "5"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "https://ai-crop-disease-detection.onrender.com/chat",
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n  \"message\": \"How do I treat tomato blight?\",\r\n  \"language\": \"en\",\r\n  \"category\": \"Blight\",\r\n  \"top_classes\": [\r\n    {\"name\": \"Tomato___Early_blight\", \"prob\": 0.85},\r\n    {\"name\": \"Tomato___Late_blight\", \"prob\": 0.10}\r\n  ]\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base url}}/chat",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "chat"
          ]
        }
      },
      "response": []
    },
    {
      "name": "{{base url}}/translate",
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\r\n  \"text\": \"Remove infected leaves and apply fungicide\",\r\n  \"target\": \"ur\"\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base url}}/translate",
          "host": [
            "{{base url}}"
          ],
          "path": [
            "translate"
          ]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": ""
    }
  ]
}